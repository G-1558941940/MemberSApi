<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--userMapper空间-->
<mapper namespace="com.member.api.mappers.second.PayingRecordMapper">
    <resultMap id="PayRecordMap" type="com.member.api.entity.PayRecord">
        <id column="id" property="id"/>
        <result  column=" carnumber" property="carnumber"/>
        <result column="intime" property="intime" />
        <result column="outtime" property="outtime"/>
        <result column="parktime" property="parktime" />
        <result column="payamount" property="payamount" />
        <result column="paidamount" property="paidamount" />
        <result column="paymenttype" property="paymenttype"/>
        <result column="chargetime" property="chargetime"/>
        <result column="close_optername" property="close_optername"/>
        <result column="close_accountno" property="close_accountno"/>
        <result column="parking_name" property="parking_name"/>
    </resultMap>
    <select id="PayingRecord" resultMap="PayRecordMap">
        SELECT p.id,o.car_owner_id,o.carnumber,o.intime,o.outtime,p.payamount/100.0 as payamount,p.paidamount/100.0 as paidamount ,p.paymenttype,p.chargetime,p.close_optername,
        p.close_accountno,p.parking_name,round(date_part('epoch', o.outtime - o.intime)::NUMERIC / 60) as parktime   FROM  outparking as o LEFT JOIN p_record_charge as p on p.intime=o.intime
        where o.carnumber IS NOT NULL AND  p.carnumber=#{carnumber} AND O.outtime IS NOT NULL AND p.id IS NOT NULL
    </select>
</mapper>
